<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Kwak-8 by Lerc</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <link rel="stylesheet" href="stylesheets/font-awesome.min.css">
    <script src="javascripts/scale.fix.js"></script>
    <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>

    <script src="javascripts/index.js"></script>
    <script src="javascripts/avr.js"></script>
    <link rel="stylesheet" href="stylesheets/emulator.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <style>
    noytable {
  	background-color: azure;
  	text-align: center;
    }
    notd {
  	padding:2px 8px;
    border: 1px solid black;
  	box-shadow: 0px 0px 3px 1px;
    }
    .diagram {
  	margin:10px;
  	padding: 8px 8px;
  	width : 300px;
  	font-size: smaller;
    }
    .diagram>div>h4 {
  	margin: 0;
    }
    .diagram>div {
  	background-color : oldLace;
  	padding: 8px 8px;
  	border: 1px solid black;
  	width :80%
    }
    .diagram>i {
      font-size: 32px;
    }
    </style>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Kwak-8</h1>
        <p>An 8 bit fantasy computer</p>
        <p class="view"><a href="https://github.com/Lerc/kwak-8">View the Project on GitHub <small>Lerc/kwak-8</small></a></p>
        <ul class="downloads">
          <li><a href="https://github.com/Lerc/kwak-8/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Lerc/kwak-8/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Lerc/kwak-8">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <nav class="menu">
        <ul>
          <li data-page="emulator" >The Emulator</li>
          <li data-page="about" >About</li>
          <li data-page="architecture" >Architecture</li>          
          <li data-page="development" >How to build programs</li>          
          <li data-page="examples">Example Programs</li>
        </ul>
      </nav>

      <div class="page about hidden" >
      <section>
      The KWAK-8 never existed as a physical computer.   Like <a href="http://www.pico-8.com/">Lexaloffle's excellent PICO-8</a>.
      The KWAK-8 is an emulated system for enthusiasts of constrained environments.<p/>


      When compared to the PICO-8 The KWAK-8 programming interface more closely resembles targeting a hardware device.  This means
      the interface is defined at a low-level .  The KWAK-8 uses a 8-bit virtual CPU with an
      instruction set compatible with the Arduino, and all interaction with the outside world is done
      through IO/Ports.   Unlike emulators for Actual computers in the past, The KWAK-8 is much less
      dependent on precise timing and can thus be emulated much more efficiently.<p> 
      <center>
      <div class="specs">
      <table>
      <tr><td>Instruction set</td><td>8-bit AVR</td></tr>
      <tr><td>RAM</td><td>64k</td></tr>
      <tr><td>ROM</td><td>128k</td></tr>
      <tr><td>Display</td><td>240x180<br><small>(hires mode 480x360)</small></td></tr>
      <tr><td>Colours</td><td>16<sup>†</sup>  <img src="images/Arne16.png" alt="Arne's 16 coolour palette" style="position:relative; left:10px; top:2px"></td></tr>
      <tr><td>Speed</td><td>8Mhz<br><small>(probably)</small></td></tr>
      <tr><td>Audio</td><td>8 synth voices</td></tr>
      <tr><td>Storage</td><td>None yet,planned</td></tr>
      </table>
      <small>†256 colours available with CPU intensive PixelWriting.</small>

</div>
      </center>
      To give you an idea of the reolution. Here's a mockup at 240x180 using the 16 colour palette.
      <center>
        <img class="screenshot" src="images/QuiteFresh_Arne16_240x180.png"> - <img class="screenshot" height="360" src="images/QuiteFresh_Arne16_240x180.png"><br> game mockup image by <a href="http://quitefreshgames.tumblr.com/">Stefan Åhlin</a>
      </center>

      Making the instruction set compatable with 8 the 8-bit avr means, that many tools designed for the Arduino ecosystem can be
      repurposed to work on the Kwak-8.    This includes Assemblers, compilers and interpreted languages.

      The 8-bit AVR compatible instruction set means many tools designed for micro-controllers can be used with the KWAK-8.
      You can write programs in assembly, C, or a variety of languages that already have AVR support.
      <p/>

      </section>

      <section>
      The main difference between the Kwak-8 architecture and real 8-bit computers and consoles is how they manage the display.
      Most of the classic 8-bit computers connected to a television or monitor and generated their own image
      to send out in the video signal.   The video image was generated as needed,  just in time for the video beam to pass.  There was not
      nearly enough memory available at the time to provide a framebuffer with a ready made image.   The
      consequence of this is that the image itself was a transient thing, with no real existence outside
      of the time between data-fetch and pixel output.
      <p/>

      The ephemeral nature of the image is what lead to a lot of amazing tricks being performed on
      the machines.  Hardware resources can be re-purposed multiple times during a video frame as long
      as they are in the right place for the pixels currently being output.<p/>

      What was a boon for old hardware is a drain on emulators though.  To accurately emulate those
      old machines, you need incredibly precise timing.   Programs had to get all of their ducks in a row on
      a deadline measured in microseconds.  Emulators have to note not only what happened, but when it
      happened if they want to accurately reproduce the behaviour.<p/>


      A Video beam output could be considered a write only display, with the constraint that the image
      must be written serially and with precise timing. The KWAK-8 reduces emulation cost by relaxing
      those constraints.  The display is still a write only device, but pixels may be written at any time
      and need not be strictly serial. This means that an entire class of tricks that old computers could
      do are not available in this emulator.  There are no raster interrupts and there is no beam-racing.<p/>

      In compensation, what is provided is an emulated hardware mechanism more appropriate to
      an emulator that is backed by a frame-buffer.
      </section>
    </div>

    <div class="page architecture hidden">
    <section>
      <p class="note">
      This section gives you an overview of the capabilities.  For specific port numbers of the described capabilities, 
      refer to <a href="https://github.com/Lerc/kwak-8/blob/master/IOMapping.txt">https://github.com/Lerc/kwak-8/blob/master/IOMapping.txt</a>
      </p>

      <h3>Display</h3>
      <p>
      The Kwak-8 has two display resolutions. Standard resolution is 240x180, hires mode is twice that at 480x360. 
      Display frames are assembled in a write only-display buffer that is 512x392.
      </p>
      <p>
          Writing 0x80 to port 0x40 places a portion of the buffer onscreemn in lowres mode;
        </p>
      <p>
        Writing 0x81 to port 0x40 places a portion of the buffer onscreemn in hirres mode;
      </p>
      
      
      There are 3 basic forms of writing to the display .

      <ul>
      <li> <h3>Display modes </h3>  These set all of the pixels on the output buffer reading
      from RAM and hardware registers.  The translation method of data to pixels is dependent on the mode
      <li> <h4>Blitter.</h4> You can write rectangles of data to screen in pixel formats of 2,3,4,8 pixels per byte.
      	  Blits can be X-flipped, Y-Flipped, X-Doubled, Y-Doubled, and support color 0 transparency.
      </li>
      <li>
        <h4>Serial Pixels</h4>You can position a pointer at a display position and serially write bytes
        to the display. This gives you access to 256 colour output.   There are also some blending options
        available to multiply or add to the existing pixels.  This is the most versatile display output
        mechanism but requires that the CPU do all of the display generation on its own.
      </li>
      </ul>

      A program might use any, or all three, of these mechanisms.  A common frame generation workflow might be
      <center>
      <div class="diagram">
        <div class="mode">
        <h4>Display Mode</h4>
        Background image
        </div>
        <i class="fa fa-arrow-down" ></i>
        <div class="blit">
        <h4>Blitter</h4>
        Moving 'Sprite' images
        </div>
        <i class="fa fa-arrow-down" ></i>
        <div class="pix">
        <h4>Serial pixels</h4>
      	special effects</div>
      </div>
      </center>
      <p>
      An alternative method would be to simply host  a framebuffer in RAM and do a single 240x180 Blit to place it onscreen. At 2 bytes per pixel a
      blit of 120 bytes wide and 180 high would fill the display but would also require a third of the RAM to hold the image. 
    </p>
    <p>
      Choosing the right combination of display methods requires weighing up the pros and cons.  Displays that take up less RAM mean there will be
      less data that needs to be manipulated, possibly making them faster, but they are also less flexible, which in turn might make them slower. 
      Clever use within the constraints is where much of the lasting appeal of 8-bit development lies.            
    </p>

    <h3>Audio</h3>
    <p>
      There are 8 synth voices available on the Kwak-8.  
      <ul>
        Each voice has
        <li>One of 256 basic waveforms</li>
        <li>A frequency range of 0...3900Hz</li>
        <li>Independant volume (256 levels) </li>
        <li>Pitch bend/occilation</li>
        <li>Random noise (16 levels)</li>
        <li>An attack-hold-release envelope</li>        
      </ul>
      A single port write selects which voice to configure. 8 byte sized ports control the full parameters of the voice.
      Writing to the Attack/Release port triggers a reset of the play envelope.  This is the last port of the voice
      configuration so a sound can easily be triggered by choosing a voice then writing the configuration sequentially.
      </p>
      <p>
        This asm example shows how simple it is to play a sound from 8 bytes of data stored in memory
      <pre><code>
  ldi r16,3         //play on voice 3
  out voice_Select,r16
  ldi XL, low(SoundData)  // SoundData holds the 8 bytes of the sound effect.
  ldi XH, high(SoundData)
  ld  r0,X+
  out voice_Freq_L,r0
  ld  r0,X+
  out voice_Freq_H,r0
  ld  r0,X+
  out voice_Volume,r0
  ld  r0,X+
  out voice_WaveShape,r0
  ld  r0,X+
  out voice_BendWave,r0
  ld  r0,X+
  out voice_BendAmplitude,r0
  ld  r0,X+
  out voice_NoiseHold,r0
  ld  r0,X+
  out voice_AttackRelease,r0  //writing to this port triggers the Attack-hold-release cycle
      </code></pre>
    </p>
    <h3>Input</h3>
     <p>
       The eight ports for input reside at the same port addresses as the display.  The display registers are write-only registers.
       The input registers are read-only registers at the same location.

     </p>
      The Kwak-8 has 16 bits directly mapped to buttons.  These provide 
      <ul>
        <li>Up/Down/Left/Right cursor keys</li>
        <li>WASD direction keys</li>
        <li>Enter</li>
        <li>SpaceBar</li>        
        <li>BackSpace</li>        
        <li>Esc</li>
        <li>Ctrl</li>
        <li>Shift</li>
        <li>Z</li>
        <li>X</li>        
      </ul>
      <p>
      X and Y mouse coordinates are provided in a range of 0...255 measured in low-res pixels.    Mouse buttons map to the same bits as Z, X, and BackSpace
    </p>
      <p>
        There are two 8-bit time inputs.  
        <ul>
          <li>A frame counter that increments with each video frame</li>
          <li>A Second ticker that increments once per second</li>
        </ul>
      </p>
      <p>
        Finally, there is a console input.  This port reads from a buffer that can hold 10 ascii characters, the port returns zero when the buffer is empty
      </p>

      </section>
    </div>
    
    <div class="page development hidden">
      The Kwak-8 emulator takes standard .hex files. 

      The Kwak-8 instruction set is compatable with AVR based Arduinos.  This means many 
      tools that can be used for Arduino development may also be used to develop for the Kwak-8.<p>

      C development is well supported by avr-gcc.  A good backgrounder can be fount at the <a href="http://www.tldp.org/HOWTO/Avr-Microcontrollers-in-Linux-Howto/x207.html">AVR Microcontrollers in Linux HOWTO</a>.

      There is preliminary support for AVR in development builds of <a href="https://www.freepascal.org/">Free Pascal</a>. patches to add a Kwak-8 target and 
      library functions are in the works.<p>

      In general anything that builds for the AVR  has the potential to be used.  Things should work as
      long as the tool does not assume particular hardware traits of Microcontrollers 
      such as timers and interrupts.<p>
      
      The truly keen will want to develop in assember.  AVR assembly resources can be found at
      <a href="http://www.avr-asm-tutorial.net/avr_en/index.html">http://www.avr-asm-tutorial.net/avr_en/index.html</a><p>

      The only thing you need to remember is that the Microcontroller Port numbers do not apply.  
      The Kwak-8 port numbers are specified in
      <script src="https://gist-it.appspot.com/https://github.com/Lerc/kwak-8/blob/master/IOMapping.txt"></script>            

    </div>
    <div class="page examples hidden">
      Put Some Examples of programs here
      <script src="https://gist-it.appspot.com/https://github.com/Lerc/kwak-8/blob/master/c/simple/minimal.c"></script>            
    </div>
    <div class="page emulator">
      This is the Kwak-8 emulator.  You can choose an example from the option dropdown or drop a .hex file onto the emulator screen.

     
      <div class="emulator host">

      </div>
    </div>


    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
